// Email service interface for easy switching between mock and real email services
export interface EmailService {
  sendEmail(to: string, subject: string, html: string): Promise<boolean>
  sendWelcomeEmail(to: string, name: string, password: string): Promise<boolean>
  sendPasswordResetEmail(to: string, name: string, resetLink: string): Promise<boolean>
  sendFeeReminderEmail(to: string, studentName: string, amount: number, dueDate: Date): Promise<boolean>
  sendAnnouncementEmail(to: string, title: string, content: string): Promise<boolean>
}

// Mock email service for development
class MockEmailService implements EmailService {
  async sendEmail(to: string, subject: string, html: string): Promise<boolean> {
    console.log('ЁЯУз Mock Email Sent:')
    console.log(`To: ${to}`)
    console.log(`Subject: ${subject}`)
    console.log(`Content: ${html}`)
    console.log('---')
    return true
  }

  async sendWelcomeEmail(to: string, name: string, password: string): Promise<boolean> {
    const subject = 'Welcome to ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
    const html = `
      <h2>ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржо ${name}</h2>
      <p>ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛ржпрж╝ ржЖржкржирж╛ржХрзЗ рж╕рзНржмрж╛ржЧрждржо!</p>
      <p>ржЖржкржирж╛рж░ рж▓ржЧржЗржи рждржерзНржп:</p>
      <ul>
        <li>ржЗржорзЗржЗрж▓: ${to}</li>
        <li>ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб: ${password}</li>
      </ul>
      <p>ржжржпрж╝рж╛ ржХрж░рзЗ рж▓ржЧржЗржи ржХрж░рж╛рж░ ржкрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржиред</p>
      <p>ржзржирзНржпржмрж╛ржж</p>
    `
    return this.sendEmail(to, subject, html)
  }

  async sendPasswordResetEmail(to: string, name: string, resetLink: string): Promise<boolean> {
    const subject = 'ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж░рж┐рж╕рзЗржЯ - ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
    const html = `
      <h2>ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржо ${name}</h2>
      <p>ржЖржкржирж╛рж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж░рж┐рж╕рзЗржЯ ржХрж░рж╛рж░ ржЬржирзНржп ржирж┐ржЪрзЗрж░ рж▓рж┐ржВржХрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи:</p>
      <a href="${resetLink}" style="background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж░рж┐рж╕рзЗржЯ ржХрж░рзБржи</a>
      <p>ржПржЗ рж▓рж┐ржВржХржЯрж┐ рзирзк ржШржирзНржЯрж╛рж░ ржЬржирзНржп ржмрзИржзред</p>
      <p>ржзржирзНржпржмрж╛ржж</p>
    `
    return this.sendEmail(to, subject, html)
  }

  async sendFeeReminderEmail(to: string, studentName: string, amount: number, dueDate: Date): Promise<boolean> {
    const subject = 'ржлрж┐ ржкрж░рж┐рж╢рзЛржзрзЗрж░ ржЕржирзБрж╕рзНржорж╛рж░ржХ - ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
    const html = `
      <h2>ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржо</h2>
      <p>${studentName} ржПрж░ ржлрж┐ ржкрж░рж┐рж╢рзЛржзрзЗрж░ ржЕржирзБрж╕рзНржорж╛рж░ржХ:</p>
      <ul>
        <li>ржкрж░рж┐ржорж╛ржг: ${amount} ржЯрж╛ржХрж╛</li>
        <li>рж╢рзЗрж╖ рждрж╛рж░рж┐ржЦ: ${dueDate.toLocaleDateString('bn-BD')}</li>
      </ul>
      <p>ржжржпрж╝рж╛ ржХрж░рзЗ ржирж┐рж░рзНржзрж╛рж░рж┐ржд рж╕ржоржпрж╝рзЗрж░ ржоржзрзНржпрзЗ ржлрж┐ ржкрж░рж┐рж╢рзЛржз ржХрж░рзБржиред</p>
      <p>ржзржирзНржпржмрж╛ржж</p>
    `
    return this.sendEmail(to, subject, html)
  }

  async sendAnnouncementEmail(to: string, title: string, content: string): Promise<boolean> {
    const subject = `ржШрзЛрж╖ржгрж╛: ${title} - ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛`
    const html = `
      <h2>${title}</h2>
      <div>${content}</div>
      <br>
      <p>ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛</p>
    `
    return this.sendEmail(to, subject, html)
  }
}

// SendGrid email service (for future use)
class SendGridEmailService implements EmailService {
  private apiKey: string
  private fromEmail: string
  private fromName: string

  constructor() {
    this.apiKey = process.env.SENDGRID_API_KEY || ''
    this.fromEmail = process.env.EMAIL_FROM || 'noreply@darulabraar.edu.bd'
    this.fromName = process.env.EMAIL_FROM_NAME || 'ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
  }

  async sendEmail(to: string, subject: string, html: string): Promise<boolean> {
    try {
      // TODO: Implement SendGrid API call when upgrading
      // This would use @sendgrid/mail package
      console.log('SendGrid email would be sent here')
      return true
    } catch (error) {
      console.error('SendGrid email error:', error)
      return false
    }
  }

  async sendWelcomeEmail(to: string, name: string, password: string): Promise<boolean> {
    const subject = 'Welcome to ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
    const html = `
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #2c3e50;">ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржо ${name}</h2>
        <p>ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛ржпрж╝ ржЖржкржирж╛ржХрзЗ рж╕рзНржмрж╛ржЧрждржо!</p>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0;">
          <h3>ржЖржкржирж╛рж░ рж▓ржЧржЗржи рждржерзНржп:</h3>
          <p><strong>ржЗржорзЗржЗрж▓:</strong> ${to}</p>
          <p><strong>ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб:</strong> ${password}</p>
        </div>
        <p style="color: #e74c3c;"><strong>ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг:</strong> ржжржпрж╝рж╛ ржХрж░рзЗ рж▓ржЧржЗржи ржХрж░рж╛рж░ ржкрж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржиред</p>
        <p>ржзржирзНржпржмрж╛ржж<br>${this.fromName}</p>
      </div>
    `
    return this.sendEmail(to, subject, html)
  }

  async sendPasswordResetEmail(to: string, name: string, resetLink: string): Promise<boolean> {
    const subject = 'ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж░рж┐рж╕рзЗржЯ - ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
    const html = `
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #2c3e50;">ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржо ${name}</h2>
        <p>ржЖржкржирж╛рж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж░рж┐рж╕рзЗржЯ ржХрж░рж╛рж░ ржЬржирзНржп ржирж┐ржЪрзЗрж░ ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи:</p>
        <div style="text-align: center; margin: 30px 0;">
          <a href="${resetLink}" style="background: #007bff; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; display: inline-block;">ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж░рж┐рж╕рзЗржЯ ржХрж░рзБржи</a>
        </div>
        <p style="color: #e74c3c;">ржПржЗ рж▓рж┐ржВржХржЯрж┐ рзирзк ржШржирзНржЯрж╛рж░ ржЬржирзНржп ржмрзИржзред</p>
        <p>ржзржирзНржпржмрж╛ржж<br>${this.fromName}</p>
      </div>
    `
    return this.sendEmail(to, subject, html)
  }

  async sendFeeReminderEmail(to: string, studentName: string, amount: number, dueDate: Date): Promise<boolean> {
    const subject = 'ржлрж┐ ржкрж░рж┐рж╢рзЛржзрзЗрж░ ржЕржирзБрж╕рзНржорж╛рж░ржХ - ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
    const html = `
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #2c3e50;">ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржо</h2>
        <p>${studentName} ржПрж░ ржлрж┐ ржкрж░рж┐рж╢рзЛржзрзЗрж░ ржЕржирзБрж╕рзНржорж╛рж░ржХ:</p>
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 5px; margin: 20px 0;">
          <h3 style="color: #856404; margin-top: 0;">ржмржХрзЗржпрж╝рж╛ ржлрж┐</h3>
          <p><strong>ржкрж░рж┐ржорж╛ржг:</strong> ${amount} ржЯрж╛ржХрж╛</p>
          <p><strong>рж╢рзЗрж╖ рждрж╛рж░рж┐ржЦ:</strong> ${dueDate.toLocaleDateString('bn-BD')}</p>
        </div>
        <p>ржжржпрж╝рж╛ ржХрж░рзЗ ржирж┐рж░рзНржзрж╛рж░рж┐ржд рж╕ржоржпрж╝рзЗрж░ ржоржзрзНржпрзЗ ржлрж┐ ржкрж░рж┐рж╢рзЛржз ржХрж░рзБржиред</p>
        <p>ржзржирзНржпржмрж╛ржж<br>${this.fromName}</p>
      </div>
    `
    return this.sendEmail(to, subject, html)
  }

  async sendAnnouncementEmail(to: string, title: string, content: string): Promise<boolean> {
    const subject = `ржШрзЛрж╖ржгрж╛: ${title} - ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛`
    const html = `
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #007bff; color: white; padding: 20px; text-align: center;">
          <h1 style="margin: 0;">ржШрзЛрж╖ржгрж╛</h1>
        </div>
        <div style="padding: 20px;">
          <h2 style="color: #2c3e50;">${title}</h2>
          <div style="line-height: 1.6;">${content}</div>
        </div>
        <div style="background: #f8f9fa; padding: 15px; text-align: center; border-top: 1px solid #dee2e6;">
          <p style="margin: 0; color: #6c757d;">${this.fromName}</p>
        </div>
      </div>
    `
    return this.sendEmail(to, subject, html)
  }
}

// Mailgun email service (for future use)
class MailgunEmailService implements EmailService {
  private apiKey: string
  private domain: string
  private fromEmail: string
  private fromName: string

  constructor() {
    this.apiKey = process.env.MAILGUN_API_KEY || ''
    this.domain = process.env.MAILGUN_DOMAIN || ''
    this.fromEmail = process.env.EMAIL_FROM || 'noreply@darulabraar.edu.bd'
    this.fromName = process.env.EMAIL_FROM_NAME || 'ржжрж╛рж░рзБрж▓ ржЖржмрж░рж╛рж░ ржоржбрзЗрж▓ ржХрж╛ржорж┐рж▓ ржорж╛ржжрзНрж░рж╛рж╕рж╛'
  }

  async sendEmail(to: string, subject: string, html: string): Promise<boolean> {
    try {
      // TODO: Implement Mailgun API call when upgrading
      // This would use mailgun-js package
      console.log('Mailgun email would be sent here')
      return true
    } catch (error) {
      console.error('Mailgun email error:', error)
      return false
    }
  }

  async sendWelcomeEmail(to: string, name: string, password: string): Promise<boolean> {
    // Same implementation as SendGrid
    return this.sendEmail(to, 'Welcome', `Welcome ${name}, your password is ${password}`)
  }

  async sendPasswordResetEmail(to: string, name: string, resetLink: string): Promise<boolean> {
    // Same implementation as SendGrid
    return this.sendEmail(to, 'Password Reset', `Reset your password: ${resetLink}`)
  }

  async sendFeeReminderEmail(to: string, studentName: string, amount: number, dueDate: Date): Promise<boolean> {
    // Same implementation as SendGrid
    return this.sendEmail(to, 'Fee Reminder', `Fee due for ${studentName}: ${amount}`)
  }

  async sendAnnouncementEmail(to: string, title: string, content: string): Promise<boolean> {
    // Same implementation as SendGrid
    return this.sendEmail(to, title, content)
  }
}

// Factory function to get the appropriate email service
export function getEmailService(): EmailService {
  const provider = process.env.EMAIL_PROVIDER || 'mock'
  
  switch (provider) {
    case 'sendgrid':
      return new SendGridEmailService()
    case 'mailgun':
      return new MailgunEmailService()
    case 'mock':
    default:
      return new MockEmailService()
  }
}

// Export default instance
export default getEmailService()
